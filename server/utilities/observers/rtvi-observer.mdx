---
title: "RTVI Observer"
description: "Converting pipeline frames to RTVI protocol messages"
---

The `RTVIObserver` converts internal pipeline frames into RTVI protocol messages that can be consumed by clients. It acts as a bridge between Pipecat's internal frame system and external Pipecat client SDKs.

## Purpose

The `RTVIObserver` serves two main purposes:

1. Converting internal frames to RTVI protocol messages
2. Managing state for aggregated messages (like bot transcriptions)

## Frame Types Handled

The observer processes several types of frames:

### Speech Events

- `UserStartedSpeakingFrame` → `RTVIUserStartedSpeakingMessage`
- `UserStoppedSpeakingFrame` → `RTVIUserStoppedSpeakingMessage`
- `BotStartedSpeakingFrame` → `RTVIBotStartedSpeakingMessage`
- `BotStoppedSpeakingFrame` → `RTVIBotStoppedSpeakingMessage`

### Transcription Events

- `TranscriptionFrame` → `RTVIUserTranscriptionMessage(final=true)`
- `InterimTranscriptionFrame` → `RTVIUserTranscriptionMessage(final=false)`

### LLM Events

- `LLMFullResponseStartFrame` → `RTVIBotLLMStartedMessage`
- `LLMFullResponseEndFrame` → `RTVIBotLLMStoppedMessage`
- `LLMTextFrame` → `RTVIBotLLMTextMessage`

### TTS Events

- `TTSStartedFrame` → `RTVIBotTTSStartedMessage`
- `TTSStoppedFrame` → `RTVIBotTTSStoppedMessage`
- `TTSTextFrame` → `RTVIBotTTSTextMessage`

### Other Events

- `OpenAILLMContextFrame` → `RTVIUserLLMTextMessage`
- `MetricsFrame` → `RTVIMetricsMessage`

## Frame Deduplication

The observer uses a set to track processed frames, ensuring each frame is only processed once:

```python
if frame.id in self._frames_seen:
    return
self._frames_seen.add(frame.id)
```

## Usage

The `RTVIObserver` is created and attached through the RTVI processor:

```python
# Create the RTVIProcessor
rtvi = RTVIProcessor(config=RTVIConfig(config=[]))

# Add the RTVI processor to the pipeline
pipeline = Pipeline(
    [
        transport.input(),
        rtvi,
        context_aggregator.user(),
        llm,
        tts,
        ta,
        transport.output(),
        context_aggregator.assistant(),
    ]
)

# Create and configure the task with the RTVI observer
task = PipelineTask(
    pipeline,
    params=PipelineParams(
        allow_interruptions=True,
        enable_metrics=True,
        enable_usage_metrics=True,
    ),
    observers=[RTVIObserver(rtvi)],
)
```

## Key Features

- **Frame Deduplication**: Ensures each frame is processed only once
- **Message Conversion**: Transforms internal frames to RTVI protocol messages
- **Protocol Compliance**: Ensures all messages follow the RTVI protocol
